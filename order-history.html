<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order History</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f1115; color:#e7eaf0; padding:20px; text-align:center; margin:0; }
    header { background:#171a21; padding:12px 20px; text-align:center; color:#06b6d4; font-size:18px; font-weight:bold; box-shadow:0 2px 6px rgba(0,0,0,0.4); margin-bottom:15px; }
    h2 { color:#06b6d4; margin-bottom:10px; }
    table { width:95%; margin:auto; border-collapse:collapse; background:#171a21; font-size:14px; }
    th, td { border:1px solid #333; padding:6px; text-align:center; }
    th { background:#06b6d4; color:#001; font-size:13px; }
    td { font-size:13px; }
    .status-box { padding:4px 8px; border-radius:6px; color:#fff; font-size:13px; font-weight:bold; }
    .waiting { background:#eab308; }
    .completed { background:#22c55e; }
    .cancelled { background:#ef4444; }
  </style>
</head>
<body>
  <header>üíé Sarkar Telecom - Order History</header>
  <h2>üìú My Orders</h2>
  <table>
    <thead>
      <tr>
        <th>SL</th>
        <th>Number</th>
        <th>Amount</th>
        <th>Status</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody id="orderTable"></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbx_sBNjUxFX931jcDyEw2IVzrVpZCmzSVwVCboJx7DVaKN8YBI6E6z0pYoCwF-vhHvc1Q/exec";
    const userEmail = localStorage.getItem("userEmail");
    if (!userEmail) {
      alert("‚ö†Ô∏è Please login first!");
      window.location.href = "login.html";
    }

    const orderTable = document.getElementById("orderTable");

    async function loadOrders() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        if (!data.ok) {
          orderTable.innerHTML = "<tr><td colspan='5'>‚ùå Failed to load orders!</td></tr>";
          return;
        }

        const rows = data.rows.slice(1).reverse().filter(row => row[4] === userEmail); 
        // ‡¶ß‡¶∞‡¶≤‡¶æ‡¶Æ ‡ß´‡¶Æ ‡¶ï‡¶≤‡¶æ‡¶Æ‡ßá (index 4) ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤/‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá

        if (!rows.length) {
          orderTable.innerHTML = "<tr><td colspan='5'>‚ö† No orders found.</td></tr>";
          return;
        }

        orderTable.innerHTML = "";
        rows.forEach((row, i) => {
          const [time, number, amount, status, user] = row;
          let statusClass = "waiting";
          if (status && status.toLowerCase() === "complete") statusClass = "completed";
          else if (status && status.toLowerCase() === "cancel") statusClass = "cancelled";

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${i+1}</td>
            <td>${number || "-"}</td>
            <td>${amount || "-"}</td>
            <td><span class="status-box ${statusClass}">${status}</span></td>
            <td>${time || "-"}</td>
          `;
          orderTable.appendChild(tr);
        });

      } catch (err) {
        orderTable.innerHTML = `<tr><td colspan='5'>‚ùå Error: ${err.message}</td></tr>`;
      }
    }

    loadOrders();
  </script>
</body>
</html>