<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - Sarkar Telecom</title>
  <style>
    :root { --bg:#0f1115; --card:#171a21; --text:#e7eaf0;
      --muted:#9aa3b2; --accent:#06b6d4; --bad:#ef4444; }
    body { background:var(--bg); color:var(--text); font-family:Arial, sans-serif; margin:0; }
    header { background:var(--card); padding:12px 16px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; color:var(--accent); }
    .user-box { display:flex; align-items:center; gap:10px; }
    .auth-btn { background:var(--accent); border:none; padding:6px 10px; border-radius:6px; font-weight:600; cursor:pointer; }
    .auth-btn.logout { background:var(--bad); color:#fff; }
    main { padding:20px; }
    h2 { color:var(--accent); }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:10px; border-bottom:1px solid #2b3347; text-align:center; font-size:14px; }
    th { background:#1f2430; }
    tr:hover { background:#1c212e; }
    .search-box { margin:10px 0; display:flex; gap:8px; }
    .search-box input { flex:1; padding:8px; border-radius:6px; border:1px solid #2b3347; background:#0f1115; color:var(--text); }
    .btn { padding:8px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .btn.search { background:var(--accent); color:#001; }
    .btn.clear { background:var(--bad); color:#fff; }
    .pager { margin-top:12px; display:flex; justify-content:center; gap:10px; }
    .pager button { padding:6px 12px; border:none; border-radius:6px; background:var(--accent); color:#001; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>‚öôÔ∏è Sarkar Telecom - Admin Panel</h1>
    <div class="user-box">
      <span id="userInfo">Checking...</span>
      <button id="authBtn" class="auth-btn">Login</button>
    </div>
  </header>

  <main>
    <h2>üìú All Orders</h2>
    <div class="search-box">
      <input type="text" id="searchBox" placeholder="Search by Number / Amount / Status / Email">
      <button class="btn search" onclick="doSearch()">Search</button>
      <button class="btn clear" onclick="clearSearch()">Clear</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>SL</th>
          <th>Number</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Email</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody id="orderTable">
        <tr><td colspan="6">üîÑ Loading...</td></tr>
      </tbody>
    </table>

    <div class="pager">
      <button onclick="prevPage()">‚¨Ö Prev</button>
      <button onclick="nextPage()">Next ‚û°</button>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // üîπ Firebase Config (order.html ‡¶è‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á)
    const firebaseConfig = {
      apiKey: "AIzaSyBIIOv-2Laqugv5_HAIRNJllp8YUfYndF8",
      authDomain: "diamond-recharge-f7f59.firebaseapp.com",
      projectId: "diamond-recharge-f7f59",
      storageBucket: "diamond-recharge-f7f59.appspot.com",
      messagingSenderId: "657717928489",
      appId: "1:657717928489:web:70431ebc9afb7002d4b238"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // üîπ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®
    const ADMIN_EMAILS = ["samrat.khulnas@gmail.com"];

    let currentUser=null;
    const userInfo=document.getElementById("userInfo");
    const authBtn=document.getElementById("authBtn");
    const orderTable=document.getElementById("orderTable");

    // Pagination
    let page=0, perPage=10, orders=[], filteredOrders=[];

    onAuthStateChanged(auth,(user)=>{
      if(user){
        currentUser=user;
        userInfo.textContent="üë§ "+user.email;
        authBtn.textContent="Logout";
        authBtn.classList.add("logout");
        authBtn.onclick=()=>signOut(auth);

        if(ADMIN_EMAILS.includes(user.email)){
          loadOrders(); // ‚úÖ Admin ‡¶π‡¶≤‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶¨‡ßã
        }else{
          orderTable.innerHTML="<tr><td colspan='6'>‚õî Access denied. Not an admin.</td></tr>";
        }
      }else{
        currentUser=null;
        userInfo.textContent="Not logged in";
        authBtn.textContent="Login";
        authBtn.classList.remove("logout");
        authBtn.onclick=()=>window.location.href="login.html";
        orderTable.innerHTML="<tr><td colspan='6'>üîë Please log in</td></tr>";
      }
    });

    // üîπ Google Sheet ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°
    async function loadOrders(){
      try{
        const sheetId="1FAIpQLScLsqajnZepD3HBTwnXwdjGQaItAVtnnGPRkD3TBsU3lPLzuQ"; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Google Form Sheet ID
        const url=`https://opensheet.elk.sh/${sheetId}/responses`;
        const res=await fetch(url);
        const data=await res.json();
        
        // Google Form Response ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶è‡¶°‡¶ú‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        orders=data.map((row,i)=>({
          number: row["Number"] || row["entry.1172671786"] || "",
          amount: row["Amount"] || row["entry.1509335158"] || "",
          status: row["Status"] || row["entry.588493421"] || "Waiting",
          email: row["Email"] || row["entry.198105099"] || "",
          time: row["Timestamp"] || ""
        }));
        
        filteredOrders=orders;
        page=0;
        renderTable();
      }catch(e){
        console.error("Sheet load error",e);
        orderTable.innerHTML="<tr><td colspan='6'>‚ö† Failed to load orders</td></tr>";
      }
    }

    function renderTable(){
      if(filteredOrders.length===0){
        orderTable.innerHTML="<tr><td colspan='6'>‚ö† No orders found</td></tr>";
        return;
      }
      const start=page*perPage;
      const end=start+perPage;
      const rows=filteredOrders.slice(start,end).map((o,i)=>`
        <tr>
          <td>${start+i+1}</td>
          <td>${o.number}</td>
          <td>${o.amount}</td>
          <td style="color:${o.status==='Cancel'?'red':o.status==='Done'?'lime':'orange'}">${o.status}</td>
          <td>${o.email}</td>
          <td>${o.time}</td>
        </tr>
      `).join("");
      orderTable.innerHTML=rows;
    }

    // üîπ Search
    window.doSearch=()=>{
      const q=document.getElementById("searchBox").value.toLowerCase();
      filteredOrders=orders.filter(o=>
        o.number.toLowerCase().includes(q) ||
        String(o.amount).includes(q) ||
        o.status.toLowerCase().includes(q) ||
        o.email.toLowerCase().includes(q)
      );
      page=0; renderTable();
    }

    window.clearSearch=()=>{
      document.getElementById("searchBox").value="";
      filteredOrders=orders; page=0; renderTable();
    }

    // üîπ Pagination
    window.prevPage=()=>{ if(page>0){ page--; renderTable(); } }
    window.nextPage=()=>{ if((page+1)*perPage<filteredOrders.length){ page++; renderTable(); } }
  </script>
</body>
</html>