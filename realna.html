<script type="module">
  import { getFirestore, collection, query, where, orderBy, limit, startAfter, getDocs } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const db=getFirestore();

  let lastDoc=null;
  let firstDoc=null;

  async function loadOrders(uid){
    const q=query(
      collection(db,"orders"),
      where("userId","==",uid),
      orderBy("createdAt","desc"),
      limit(10)
    );
    const snap=await getDocs(q);
    firstDoc=snap.docs[0];
    lastDoc=snap.docs[snap.docs.length-1];
    renderOrders(snap.docs);
  }

  async function nextPage(uid){
    const q=query(
      collection(db,"orders"),
      where("userId","==",uid),
      orderBy("createdAt","desc"),
      startAfter(lastDoc),
      limit(10)
    );
    const snap=await getDocs(q);
    lastDoc=snap.docs[snap.docs.length-1];
    renderOrders(snap.docs);
  }
</script>