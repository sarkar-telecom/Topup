<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Place Order</title>
  <style>
    :root{
      --bg:#0f1115;--card:#171a21;--text:#e7eaf0;--muted:#9aa3b2;
      --accent:#06b6d4;--ok:#10b981;--bad:#ef4444;
    }
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
    main{padding:16px;max-width:600px;margin:auto}
    h2{text-align:center;margin-bottom:16px}
    .input-box{width:100%;padding:10px;border:1px solid #333;border-radius:8px;background:#171a21;color:var(--text);margin-bottom:16px}
    .amounts{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px}
    .amount-btn{background:#1f2430;padding:12px 18px;border-radius:8px;font-weight:600;cursor:pointer;border:none;color:var(--text);transition:.2s}
    .amount-btn.active{background:var(--accent);color:#001}
    .btn{width:100%;padding:12px;font-size:16px;font-weight:700;border:none;border-radius:8px;cursor:pointer;background:var(--accent);color:#001}
    .btn:disabled{background:#333;color:#777;cursor:not-allowed}
    .msg{text-align:center;margin-top:12px;font-size:14px}
  </style>
</head>
<body>
  <!-- Header load from GitHub -->
  <div id="header"></div>
  <script>
    fetch("https://sarkar-telecom.github.io/Topup/header.html")
      .then(res=>res.text())
      .then(html=>document.getElementById("header").innerHTML=html);
  </script>

  <main id="orderBox" style="display:none;">
    <h2>Place New Order</h2>
    <input id="profileInput" type="text" class="input-box" placeholder="Profile ID or +8801XXXXXXXXX">
    
    <div class="amounts">
      <button class="amount-btn">10</button>
      <button class="amount-btn">50</button>
      <button class="amount-btn">100</button>
      <button class="amount-btn">200</button>
      <button class="amount-btn">500</button>
      <button class="amount-btn">1000</button>
      <button class="amount-btn">2000</button>
      <button class="amount-btn">5000</button>
      <button class="amount-btn">10000</button>
      <button class="amount-btn">20000</button>
    </div>

    <button id="confirmBtn" class="btn" disabled>‚úÖ Confirm Order</button>
    <div id="msg" class="msg"></div>
  </main>

  <!-- Firebase + Order Logic -->
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // üîπ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBIIOv-2Laqugv5_HAIRNJllp8YUfYndF8",
      authDomain: "diamond-recharge-f7f59.firebaseapp.com",
      projectId: "diamond-recharge-f7f59",
      storageBucket: "diamond-recharge-f7f59.appspot.com",
      messagingSenderId: "657717928489",
      appId: "1:657717928489:web:70431ebc9afb7002d4b238"
    };

    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const orderBox   = document.getElementById("orderBox");
    const profileInp = document.getElementById("profileInput");
    const confirmBtn = document.getElementById("confirmBtn");
    const msg        = document.getElementById("msg");

    let selectedAmount = null;

    // üîπ Amount select
    document.querySelectorAll(".amount-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".amount-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        selectedAmount = btn.textContent;
        confirmBtn.disabled = false;
      });
    });

    // üîπ Firebase Auth check
    onAuthStateChanged(auth, (user)=>{
      if(!user){
        window.location.href = "login.html"; // ‡¶≤‡¶ó‡¶ø‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
      } else {
        orderBox.style.display = "block"; // ‡¶≤‡¶ó‡¶ø‡¶® ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
      }
    });

    // üîπ Order submit
    confirmBtn.addEventListener("click", async ()=>{
      const profileId = profileInp.value.trim();
      if(!profileId || !selectedAmount){
        msg.textContent = "‚ö†Ô∏è Please enter Profile ID and select amount!";
        return;
      }

      confirmBtn.disabled = true;
      msg.textContent = "‚è≥ Placing order...";

      try{
        const res = await fetch("https://script.google.com/macros/s/AKfycbx_issV79GwlsTJmVkWbsenpJIoufqX_M8FV8DPM7nt3K22LS45WhGIkF0Ce9XeF_bd_A/exec", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ profileId, amount:selectedAmount, status:"Waiting" })
        });
        const data = await res.json();

        if(data.result==="success"){
          msg.textContent = "‚úÖ Order placed successfully!";
          setTimeout(()=>window.location.href="order-history.html", 1000);
        } else {
          msg.textContent = "‚ùå Failed to place order!";
        }
      }catch(err){
        msg.textContent = "‚ùå Error: "+err.message;
      }
      confirmBtn.disabled = false;
    });
  </script>
</body>
</html>